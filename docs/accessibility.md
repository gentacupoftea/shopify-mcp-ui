# アクセシビリティ対応ガイドライン

## 概要

Coneaプロジェクトでは、WCAG AA基準に準拠したアクセシビリティ対応を実施しています。このガイドラインでは、プロジェクトで採用しているアクセシビリティパターンと、それらを実装するためのユーティリティについて説明します。

## 目次

1. [アクセシビリティ基本原則](#アクセシビリティ基本原則)
2. [共通ユーティリティ](#共通ユーティリティ)
3. [コンポーネント実装パターン](#コンポーネント実装パターン)
4. [テストと検証](#テストと検証)
5. [既知の課題と今後の対応](#既知の課題と今後の対応)

## アクセシビリティ基本原則

Coneaプロジェクトでは以下の基本原則に従ってアクセシビリティを実装しています：

### 1. キーボード操作

- すべての機能はキーボードのみで操作可能であること
- フォーカス可能な要素には視覚的に明確なフォーカスインジケータを表示すること
- フォーカスの順序が論理的であること
- キーボードトラップがないこと

### 2. スクリーンリーダー対応

- 適切なARIA属性を使用すること
- 画像や視覚的要素には代替テキストを提供すること
- フォーム要素には適切なラベルを関連付けること
- 動的に変化するコンテンツには適切なライブリージョンを使用すること

### 3. 視覚デザイン

- テキストと背景のコントラスト比は4.5:1以上を確保すること
- 情報伝達において色だけに依存しないこと
- テキストサイズは調整可能であること
- レイアウトは400%までズーム可能であること

### 4. データ可視化

- グラフやチャートには非視覚的な代替表現を提供すること
- インタラクティブな可視化要素はキーボードで操作可能であること
- データの要約情報を提供すること
- モバイルデバイスでも使いやすい応答性を確保すること

## 共通ユーティリティ

### accessibility.ts

基本的なアクセシビリティユーティリティを提供します：

```typescript
// コントラスト比計算
hasAdequateContrast(foreground, background)

// フォーカススタイル
accessibleFocusStyle(theme)

// スクリーンリーダー専用スタイル
srOnly

// キーボードイベントヘルパー
handleKeyboardAction(event, onAction)

// アクセシビリティテスト
checkComponentAccessibility(component)
```

### a11yChartPatterns.ts

データ可視化コンポーネント用のアクセシビリティパターンを提供します：

```typescript
// チャートのアクセシビリティ属性生成
getChartA11yProps(props, theme, selectedIndex)

// キーボードナビゲーション設定
setupChartKeyboardNavigation(chartRef, state, announceFunction)

// スクリーンリーダー用データテーブル生成
createA11yTable(data, columns, title, selectedIndex, summaryData)

// スクリーンリーダー通知コンポーネント
A11yAnnouncer
```

## コンポーネント実装パターン

### 基本コンポーネント

すべてのコンポーネントに適用される基本パターン：

1. 適切な`role`属性の指定
2. フォーカス可能な要素への`tabIndex`設定
3. `aria-*`属性による補足情報の提供
4. キーボードイベントハンドラの実装

### フォーム要素

フォーム要素に特有のパターン：

1. 入力要素への明示的なラベル関連付け
2. バリデーションエラーの適切な伝達
3. 必須フィールドの明示
4. ヘルプテキストの提供

### データ可視化コンポーネント

チャートやグラフのアクセシビリティパターン：

1. キーボードによるデータポイントナビゲーション
2. 選択中データポイントの視覚的および音声的フィードバック
3. データの要約情報の提供
4. データテーブル形式の代替表現

### 実装例

SalesChartとBarChartコンポーネントの実装を参照してください。

## テストと検証

### Cypress + axe-coreによる自動テスト

アクセシビリティの自動テストは以下の手順で実行できます：

```bash
# 開発サーバー起動
npm start

# 別ターミナルでCypressテスト実行
npm run cypress:a11y
```

テストはCypressのテストランナーで実行され、結果が表示されます。

### テストケース

以下のテストケースが実装されています：

1. コンポーネントレベルのWCAG AA準拠確認
2. キーボードナビゲーションテスト
3. スクリーンリーダー対応要素の存在確認
4. 異なる画面サイズでのレスポンシブ動作確認
5. コントラスト比の検証

### 手動検証

自動テストだけでなく、以下の手動検証も推奨されます：

1. キーボードのみでの操作検証
2. スクリーンリーダー（VoiceOver, NVDA, JAWSなど）での読み上げ確認
3. 高コントラストモードでの表示確認
4. 文字サイズ変更時の表示確認

## 既知の課題と今後の対応

### 現在の課題

1. 一部の複雑なデータ可視化コンポーネントでキーボード操作が最適化されていない
2. ダークモード切り替え時のコントラスト比の自動調整が必要
3. アニメーション効果の減速設定が不完全

### 今後の対応

1. 残りのデータ可視化コンポーネントへのアクセシビリティパターン適用
2. パフォーマンス最適化とアクセシビリティのバランス調整
3. 自動テストの拡充とCI/CDパイプラインへの統合

## 参考リソース

- [WCAG 2.1 AA ガイドライン](https://www.w3.org/TR/WCAG21/)
- [WAI-ARIA プラクティス](https://www.w3.org/TR/wai-aria-practices-1.1/)
- [Recharts アクセシビリティ](https://recharts.org/en-US/examples/CustomizedLabelLineChart)
- [Material UI アクセシビリティ](https://mui.com/guides/accessibility/)
- [React アクセシビリティ](https://reactjs.org/docs/accessibility.html)